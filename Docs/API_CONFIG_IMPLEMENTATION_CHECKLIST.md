# API配置优化 - 实现清单

## 一、文件修改清单

### 1.1 需要修改的文件
- [ ] `frontend/src/components/ApiConfigDialog.vue` - 重构API配置对话框
- [ ] `frontend/src/App.vue` - 添加首次使用检测和模型联动
- [ ] `frontend/src/utils/apiConfig.js` - 新建：API配置工具函数（可选）

### 1.2 需要新建的文件
- [ ] `frontend/src/utils/apiConfig.js` - API配置管理工具函数

## 二、功能实现清单

### 2.1 数据结构设计
- [ ] 设计新的 localStorage 数据结构
- [ ] 实现数据迁移函数（从旧格式迁移到新格式）
- [ ] 实现配置读取函数 `getApiConfig(apiType)`
- [ ] 实现配置保存函数 `saveApiConfig(apiType, config)`
- [ ] 实现配置检查函数 `isApiConfigured(apiType)`
- [ ] 实现初始化检查函数 `isApiConfigInitialized()`
- [ ] 实现可用模型获取函数 `getAvailableModels()`

### 2.2 API配置对话框 (ApiConfigDialog.vue)
- [ ] 添加 `required` prop（控制是否为必填模式）
- [ ] 添加 `highlightApiType` prop（高亮显示特定API配置）
- [ ] 重构布局，支持API类型选择（官方/第三方）
- [ ] 实现API类型切换逻辑（Radio按钮组）
- [ ] 实现动态字段显示：
  - [ ] 官方API：显示 API Key（必填）
  - [ ] 第三方API：显示 Base URL（必填）+ API Key（可选）
- [ ] 实现配置状态实时显示（✓ 已配置 / ⚠ 未配置）
- [ ] 实现配置验证逻辑：
  - [ ] 官方API：API Key 必填验证
  - [ ] 第三方API：Base URL 必填验证 + URL格式验证
  - [ ] 至少一个API已配置验证
- [ ] 实现首次使用模式（不可关闭对话框）
- [ ] 实现高亮显示特定API配置区域
- [ ] 添加欢迎信息和配置说明（首次使用）
- [ ] 实现保存按钮的启用/禁用逻辑
- [ ] 实现保存成功后的回调处理

### 2.3 主应用组件 (App.vue)
- [ ] 添加首次使用检测逻辑（`onMounted`）
- [ ] 实现强制显示API配置对话框（首次使用）
- [ ] 修改模型列表为计算属性 `availableModels`
- [ ] 实现模型过滤逻辑（根据已配置API）
- [ ] 修改模型选择器，显示API配置状态
- [ ] 实现模型选择处理：
  - [ ] 检查对应API是否已配置
  - [ ] 未配置时显示提示并打开配置对话框
  - [ ] 高亮显示对应API配置区域
- [ ] 实现API配置更新监听
- [ ] 实现当前模型不可用时的自动切换逻辑
- [ ] 保持与现有功能的兼容性

### 2.4 向后兼容
- [ ] 实现旧数据格式检测
- [ ] 实现自动数据迁移
- [ ] 测试迁移后的数据正确性
- [ ] 保持与后端API的兼容性（header格式）

### 2.5 用户体验优化
- [ ] 添加友好的提示信息
- [ ] 实现实时验证和错误提示
- [ ] 实现键盘导航支持（Tab、Enter）
- [ ] 实现自动聚焦到第一个输入框
- [ ] 添加加载状态和成功提示
- [ ] 优化错误处理和用户反馈

## 三、测试清单

### 3.1 首次使用场景
- [ ] 新用户首次打开应用，强制显示配置对话框
- [ ] 配置对话框不可关闭（首次使用）
- [ ] 只配置Gemini API，可以正常使用
- [ ] 只配置豆包API，可以正常使用
- [ ] 配置两个API，都可以正常使用
- [ ] 配置保存后，可以正常进入主界面

### 3.2 模型联动场景
- [ ] 只配置Gemini API，只能看到Gemini模型
- [ ] 只配置豆包API，只能看到豆包模型
- [ ] 配置两个API，可以看到所有模型
- [ ] 选择未配置API的模型，提示并打开配置对话框
- [ ] 配置API后，模型列表自动更新
- [ ] 删除API配置后，对应模型自动禁用

### 3.3 API类型切换场景
- [ ] 切换到官方API，显示API Key输入框
- [ ] 切换到第三方API，显示Base URL和API Key输入框
- [ ] 官方API模式下，Base URL字段隐藏
- [ ] 第三方API模式下，API Key可选
- [ ] 切换类型时，清空不相关的字段值

### 3.4 数据验证场景
- [ ] 官方API：API Key为空时，显示错误提示
- [ ] 第三方API：Base URL为空时，显示错误提示
- [ ] 第三方API：Base URL格式错误时，显示错误提示
- [ ] 未配置任何API时，保存按钮禁用
- [ ] 至少配置一个API后，保存按钮启用

### 3.5 数据迁移场景
- [ ] 旧数据格式自动迁移到新格式
- [ ] 迁移后配置状态正确
- [ ] 迁移后可以正常使用
- [ ] 迁移后旧数据保留（或删除）

### 3.6 边界情况
- [ ] 清空所有API配置后的处理
- [ ] 当前选择的模型对应的API被删除后的处理
- [ ] 网络错误时的处理
- [ ] localStorage不可用时的处理

## 四、代码质量清单

### 4.1 代码规范
- [ ] 遵循项目代码风格
- [ ] 添加必要的注释
- [ ] 函数命名清晰
- [ ] 变量命名规范

### 4.2 性能优化
- [ ] 避免频繁的localStorage读写
- [ ] 使用计算属性优化模型列表
- [ ] 避免不必要的响应式更新

### 4.3 错误处理
- [ ] 完善的try-catch错误处理
- [ ] 友好的错误提示信息
- [ ] 错误日志记录

### 4.4 安全性
- [ ] API Key使用password类型输入框
- [ ] 不在控制台输出敏感信息
- [ ] 验证用户输入的安全性

## 五、文档更新清单

- [ ] 更新README.md（如果有）
- [ ] 更新用户使用文档
- [ ] 添加代码注释
- [ ] 更新设计文档（如有变更）

## 六、实施顺序建议

### 第一阶段：基础数据结构
1. 创建 `utils/apiConfig.js` 工具函数
2. 实现数据迁移逻辑
3. 测试数据迁移

### 第二阶段：API配置对话框
1. 重构 `ApiConfigDialog.vue` 布局
2. 实现API类型选择
3. 实现配置验证
4. 实现状态显示

### 第三阶段：模型联动
1. 修改 `App.vue` 模型列表逻辑
2. 实现模型过滤
3. 实现选择检查
4. 实现自动配置对话框

### 第四阶段：首次使用引导
1. 实现首次使用检测
2. 实现强制配置对话框
3. 添加欢迎信息

### 第五阶段：测试和优化
1. 全面测试所有场景
2. 优化用户体验
3. 修复bug
4. 性能优化

## 七、注意事项

1. **向后兼容**：确保旧版本数据可以正常迁移
2. **数据安全**：API Key 使用 password 类型，不输出到控制台
3. **用户体验**：清晰的提示和流畅的交互
4. **错误处理**：完善的错误处理和用户提示
5. **性能**：避免频繁的localStorage操作
6. **测试**：充分测试各种场景和边界情况

